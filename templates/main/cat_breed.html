{% extends 'base.html' %}
{% load static %}

{% block title %}Î¡Î¬Ï„ÏƒÎ± Î“Î¬Ï„Î±Ï‚ - Î‘ÏƒÏ†Î¬Î»Î¹ÏƒÎ· Î¥Î³ÎµÎ¯Î±Ï‚{% endblock %}

{% block content %}
<section class="hero-section">
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-title" style="font-size: 2.3rem; margin-bottom: 1rem;">
                <span style="background: linear-gradient(45deg, #ffffff, #f0f8ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    Î“Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î±Ï€ÏŒ Ï„Î¹Ï‚ ÏÎ¬Ï„ÏƒÎµÏ‚ Ï„Î·Ï‚ Î³Î¬Ï„Î±Ï‚ ÏƒÎ±Ï‚;
                </span>
            </h1>
            
            <!-- Pet Info Reminder -->
            <div class="pet-info-reminder" style="margin-bottom: 3rem;">
                <div class="pet-info-card">
                    <div class="pet-icon-small" id="pet-reminder-icon">ğŸ±</div>
                    <span class="pet-reminder-text" id="pet-reminder-text">Î“Î¬Ï„Î±</span>
                    <span class="gender-indicator" id="gender-indicator">
                        <!-- Will be filled by JavaScript -->
                    </span>
                </div>
            </div>
            
            <!-- Breed Knowledge Options -->
            <div class="breed-knowledge-options">
                <div class="knowledge-buttons">
                    <button class="knowledge-btn active" id="yes-btn" onclick="toggleKnowledge('yes')">
                        <i class="fas fa-check-circle"></i>
                        ÎÎ‘Î™
                    </button>
                    <button class="knowledge-btn" id="no-btn" onclick="toggleKnowledge('no')">
                        <i class="fas fa-times-circle"></i>
                        ÎŸÎ§Î™
                    </button>
                </div>
            </div>
            
            <!-- Breed Selection Section (shown when YES) -->
            <div class="breed-selection-section" id="breed-section">
                <div class="breed-options">
                    <!-- Dropdown Selection -->
                    <div class="breed-option-card active" id="dropdown-card">
                        <div class="option-header">
                            <div class="option-icon">ğŸ“‹</div>
                            <h3 class="option-title">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Ï€ÏŒ Ï„Î· Î»Î¯ÏƒÏ„Î±</h3>
                        </div>
                        
                        <div class="breed-dropdown-container">
                            <select id="breed-dropdown" class="form-select breed-select">
                                <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÏÎ¬Ï„ÏƒÎ±...</option>
                                {% for breed in breeds %}
                                <option value="{{ breed }}">{{ breed }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <!-- Custom Input -->
                    <div class="breed-option-card" id="custom-card">
                        <div class="option-header" onclick="toggleBreedOption('custom')">
                            <div class="option-icon">âœï¸</div>
                            <h3 class="option-title">Î‘Î½ Î´ÎµÎ½ Î²ÏÎ¯ÏƒÎºÎµÏ„Îµ Ï„Î· ÏÎ¬Ï„ÏƒÎ± ÏƒÏ„Î·Î½ Î»Î¯ÏƒÏ„Î± Î¼Î±Ï‚</h3>
                        </div>
                        
                        <div class="custom-breed-inputs" style="display: none;">
                            <p class="instruction-text">Î‘ÏÏ‡Î¯ÏƒÏ„Îµ Î½Î± Ï€Î»Î·ÎºÏ„ÏÎ¿Î»Î¿Î³ÎµÎ¯Ï„Îµ Ï„Î· ÏÎ¬Ï„ÏƒÎ±</p>
                            <input type="text" id="custom-breed" class="form-control breed-input" placeholder="Î Î»Î·ÎºÏ„ÏÎ¿Î»Î¿Î³Î®ÏƒÏ„Îµ Ï„Î· ÏÎ¬Ï„ÏƒÎ±...">
                            
                            <div class="mixed-breed-section" style="margin-top: 1.5rem;">
                                <div class="mixed-breed-question">
                                    <label class="form-check-label">
                                        <input type="checkbox" id="is-mixed" class="form-check-input">
                                        Î•Î¯Î½Î±Î¹ Ï„Î¿ ÎºÎ±Ï„Î¿Î¹ÎºÎ¯Î´Î¹ÏŒ ÏƒÎ±Ï‚ Î¼Î¹ÎºÏ„Î®Ï‚ ÏÎ¬Ï„ÏƒÎ±Ï‚;
                                    </label>
                                </div>
                                
                                <div class="additional-breed" id="additional-breed-section" style="display: none;">
                                    <p class="instruction-text">Î•Î¬Î½ Î½Î±Î¹, Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Î¬Î»Î»Î· ÏÎ¬Ï„ÏƒÎ±:</p>
                                    <input type="text" id="additional-breed-input" class="form-control breed-input" placeholder="Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Î¬Î»Î»Î· ÏÎ¬Ï„ÏƒÎ±">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Weight Selection Section -->
            <div class="weight-selection-section" id="weight-section">
                <h2 class="weight-title" style="margin-top: 3rem;">
                    <span style="background: linear-gradient(45deg, #ffffff, #f0f8ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                        Î Î¿Î¹Î¿ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Ï€ÎµÏÎ¯Ï€Î¿Ï… Î²Î¬ÏÎ¿Ï‚ Ï„Î·Ï‚ Î³Î¬Ï„Î±Ï‚ ÏƒÎ±Ï‚;
                    </span>
                </h2>
                
                <div class="cat-weight-options">
                    <div class="weight-card" data-weight="up-to-10" onclick="selectWeight('up-to-10')">
                        <div class="weight-icon">ğŸ±</div>
                        <h3 class="weight-range">Î­Ï‰Ï‚ 10 ÎºÎ¹Î»Î¬</h3>
                        <p class="weight-description">ÎšÎ±Î½Î¿Î½Î¹ÎºÏŒ Î¼Î­Î³ÎµÎ¸Î¿Ï‚</p>
                    </div>
                    
                    <div class="weight-card" data-weight="11-20" onclick="selectWeight('11-20')">
                        <div class="weight-icon">ğŸ±</div>
                        <h3 class="weight-range">11-20 ÎºÎ¹Î»Î¬</h3>
                        <p class="weight-description">ÎœÎµÎ³Î¬Î»Î¿ Î¼Î­Î³ÎµÎ¸Î¿Ï‚</p>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Buttons -->
            <div class="navigation-buttons" style="margin-top: 3rem;">
                <button class="btn btn-lg btn-light me-3" onclick="goBack()" style="padding: 1rem 2rem; border-radius: 15px; font-weight: 600;">
                    <i class="fas fa-arrow-left me-2"></i>
                    Î Î¯ÏƒÏ‰
                </button>
                <button class="btn btn-lg" onclick="submitBreed()" style="background: var(--brand-gradient); border: none; color: white; padding: 1rem 2rem; border-radius: 15px; font-weight: 600; box-shadow: var(--shadow-soft);">
                    Î•Ï€ÏŒÎ¼ÎµÎ½Î¿
                    <i class="fas fa-arrow-right ms-2"></i>
                </button>
            </div>
            
            <!-- Decorative elements -->
            <div class="floating-decorations">
                <div class="floating-element" style="top: 15%; left: 10%; font-size: 2rem;">ğŸ¾</div>
                <div class="floating-element" style="top: 25%; right: 15%; font-size: 1.5rem;">ğŸ“‹</div>
                <div class="floating-element" style="bottom: 30%; left: 20%; font-size: 2.5rem;">âš–ï¸</div>
                <div class="floating-element" style="bottom: 20%; right: 10%; font-size: 1.8rem;">ğŸ·ï¸</div>
                <div class="floating-element" style="top: 40%; left: 5%; font-size: 1.2rem;">âœ¨</div>
                <div class="floating-element" style="top: 60%; right: 5%; font-size: 1.4rem;">ğŸ’</div>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get parameters from URL
    const urlParams = new URLSearchParams(window.location.search);
    const gender = urlParams.get('gender');
    
    // Set gender indicator
    if (gender === 'male') {
        document.getElementById('gender-indicator').innerHTML = '<span style="color: #4A90E2;">â™‚ï¸ Î‘ÏÏƒÎµÎ½Î¹ÎºÏŒ</span>';
    } else if (gender === 'female') {
        document.getElementById('gender-indicator').innerHTML = '<span style="color: #E24A90;">â™€ï¸ Î˜Î·Î»Ï…ÎºÏŒ</span>';
    }
    
    // Add entrance animations
    const cards = document.querySelectorAll('.breed-option-card, .weight-card');
    cards.forEach((card, index) => {
        card.style.animation = `fadeInUp 1s ease-out ${0.3 + index * 0.1}s both`;
    });
    
    // Mixed breed checkbox handler
    document.getElementById('is-mixed').addEventListener('change', function() {
        const additionalSection = document.getElementById('additional-breed-section');
        if (this.checked) {
            additionalSection.style.display = 'block';
            additionalSection.style.animation = 'fadeInUp 0.5s ease-out';
        } else {
            additionalSection.style.display = 'none';
        }
    });
});

function toggleKnowledge(option) {
    const yesBtn = document.getElementById('yes-btn');
    const noBtn = document.getElementById('no-btn');
    const breedSection = document.getElementById('breed-section');
    const catDefaultSection = document.getElementById('cat-default-section');
    
    if (option === 'yes') {
        yesBtn.classList.add('active');
        noBtn.classList.remove('active');
        breedSection.style.display = 'block';
        catDefaultSection.style.display = 'none';
        breedSection.style.animation = 'fadeInUp 0.5s ease-out';
    } else {
        noBtn.classList.add('active');
        yesBtn.classList.remove('active');
        breedSection.style.display = 'none';
        catDefaultSection.style.display = 'block';
        catDefaultSection.style.animation = 'fadeInUp 0.5s ease-out';
    }
}

function toggleBreedOption(option) {
    const dropdownCard = document.getElementById('dropdown-card');
    const customCard = document.getElementById('custom-card');
    const customInputs = document.querySelector('.custom-breed-inputs');
    
    if (option === 'custom') {
        dropdownCard.classList.remove('active');
        customCard.classList.add('active');
        customInputs.style.display = 'block';
        customInputs.style.animation = 'fadeInUp 0.5s ease-out';
    } else {
        customCard.classList.remove('active');
        dropdownCard.classList.add('active');
        customInputs.style.display = 'none';
    }
}

function selectWeight(weightRange) {
    // Remove active class from all weight cards
    document.querySelectorAll('.weight-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // Add selected class to clicked card
    const selectedCard = document.querySelector(`[data-weight="${weightRange}"]`);
    selectedCard.classList.add('selected');
    
    // Add selection animation
    selectedCard.style.transform = 'scale(1.05)';
    selectedCard.style.boxShadow = '0 20px 50px rgba(90, 200, 189, 0.4)';
    
    setTimeout(() => {
        selectedCard.style.transform = '';
    }, 300);
}

function submitBreed() {
    const urlParams = new URLSearchParams(window.location.search);
    const petType = urlParams.get('type');
    const gender = urlParams.get('gender');
    const birthdate = urlParams.get('birthdate');
    
    let breedInfo = '';
    
    // Always check weight selection first
    const selectedWeight = document.querySelector('.weight-card.selected');
    if (!selectedWeight) {
        alert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î¼Î¹Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± Î²Î¬ÏÎ¿Ï…Ï‚.');
        return;
    }
    const weightInfo = selectedWeight.querySelector('.weight-range').textContent;
    
    // Check if user knows breed or not
    if (document.getElementById('yes-btn').classList.contains('active')) {
        // User knows breed
        if (document.getElementById('dropdown-card').classList.contains('active')) {
            const selectedBreed = document.getElementById('breed-dropdown').value;
            if (!selectedBreed) {
                alert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î¼Î¹Î± ÏÎ¬Ï„ÏƒÎ± Î±Ï€ÏŒ Ï„Î· Î»Î¯ÏƒÏ„Î±.');
                return;
            }
            breedInfo = `${selectedBreed} (${weightInfo})`;
        } else {
            const customBreed = document.getElementById('custom-breed').value.trim();
            if (!customBreed) {
                alert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ±Î³Î¬Î³ÎµÏ„Îµ Ï„Î· ÏÎ¬Ï„ÏƒÎ±.');
                return;
            }
            breedInfo = customBreed;
            
            if (document.getElementById('is-mixed').checked) {
                const additionalBreed = document.getElementById('additional-breed-input').value.trim();
                if (additionalBreed) {
                    breedInfo += ` + ${additionalBreed}`;
                }
            }
            breedInfo += ` (${weightInfo})`;
        }
    } else {
        // User doesn't know breed - use "ÎšÎ¿Î¹Î½ÏŒ ÎµÏ…ÏÏ‰Ï€Î±ÏŠÎºÏŒ ÎºÎ¿Î½Ï„ÏŒÏ„ÏÎ¹Ï‡Î¿"
        breedInfo = `ÎšÎ¿Î¹Î½ÏŒ ÎµÏ…ÏÏ‰Ï€Î±ÏŠÎºÏŒ ÎºÎ¿Î½Ï„ÏŒÏ„ÏÎ¹Ï‡Î¿ (${weightInfo})`;
    }
    
    // Add success animation
    const button = event.target;
    button.style.transform = 'scale(0.95)';
    button.innerHTML = '<i class="fas fa-check me-2"></i>Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±...';
    
    setTimeout(() => {
        // Navigate to pet name page
        window.location.href = `{% url 'main:pet_name' %}?type=${petType}&gender=${gender}&birthdate=${encodeURIComponent(birthdate)}&breed=${encodeURIComponent(breedInfo)}`;
    }, 1000);
}

function goBack() {
    const content = document.querySelector('.hero-content');
    content.style.animation = 'fadeOut 0.5s ease-in';
    
    setTimeout(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const petType = urlParams.get('type');
        const gender = urlParams.get('gender');
        window.location.href = `{% url "main:pet_birthdate" %}?type=${petType}&gender=${gender}`;
    }, 500);
}

// Add click handler to dropdown card
document.getElementById('dropdown-card').addEventListener('click', function() {
    if (!this.classList.contains('active')) {
        toggleBreedOption('dropdown');
    }
});
</script>
{% endblock %}
